<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Saral Sahayata</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Hind:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <style>
        :root {
            --primary-color: #1a237e;
            --primary-dark: #0d1b6b;
            --primary-light: #283593;
            --secondary-color: #d32f2f;
            --accent-color: #ff6f00;
            --background-color: #f8fafc;
            --card-background: #ffffff;
            --text-color: #202124;
            --light-text-color: #5f6368;
            --border-color: #dadce0;
            --danger-color: #ea4335;
            --success-color: #34a853;
            --warning-color: #f9ab00;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            --border-radius: 12px;
        }
        
        * {
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Hind', 'Poppins', sans-serif;
            margin: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            line-height: 1.6;
        }
        
        /* Tricolor Strip */
        .tricolor-strip {
            height: 5px;
            display: flex;
            background: linear-gradient(to right, #ff9933 33%, #ffffff 33%, #ffffff 66%, #138808 66%);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        /* Header with Consistent Blue Background */
        .app-header {
            background: var(--primary-color);
            color: white;
            padding: 12px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .app-logo {
            width: 42px;
            height: 42px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--primary-color);
            font-size: 18px;
            border: 2px solid #ff9933;
            overflow: hidden;
        }
        
        .app-logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .app-name {
            font-size: 18px;
            font-weight: 700;
        }
        
        .app-tagline {
            font-size: 10px;
            opacity: 0.9;
            margin-top: -2px;
            color: rgba(255,255,255,0.8);
        }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .auth-button {
            padding: 8px 20px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.15);
            color: white;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .auth-button:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-1px);
        }
        
        /* Language Button */
        .language-button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.15);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 14px;
            position: relative;
        }
        
        .language-button:hover {
            background: rgba(255,255,255,0.25);
            transform: scale(1.05);
        }
        
        .language-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            padding: 10px 0;
            min-width: 140px;
            display: none;
            margin-top: 10px;
            z-index: 1001;
            border: 1px solid var(--border-color);
            transform-origin: top right;
            animation: dropdownFadeIn 0.2s ease-out;
        }
        
        .language-dropdown.show {
            display: block;
        }
        
        .language-option {
            padding: 10px 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: var(--text-color);
            transition: background 0.3s;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 14px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .language-option:hover {
            background: #f0f5ff;
        }
        
        .language-option.active {
            background: #e3f2fd;
            color: var(--primary-color);
        }
        
        .language-option i {
            width: 16px;
            color: var(--primary-color);
            font-size: 14px;
        }
        
        .profile-section {
            position: relative;
            display: none;
        }
        
        .profile-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.15);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 14px;
        }
        
        .profile-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: scale(1.05);
        }
        
        /* Improved Profile Dropdown */
        .profile-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            padding: 15px 0;
            min-width: 260px;
            display: none;
            margin-top: 10px;
            z-index: 1000;
            border: 1px solid var(--border-color);
            transform-origin: top right;
            animation: dropdownFadeIn 0.2s ease-out;
        }
        
        @keyframes dropdownFadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .profile-dropdown.show {
            display: block;
        }
        
        .dropdown-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: var(--text-color);
            transition: background 0.3s;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 15px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .dropdown-item:hover {
            background: #f0f5ff;
        }
        
        .dropdown-item i {
            width: 18px;
            color: var(--primary-color);
            font-size: 16px;
        }
        
        .dropdown-divider {
            height: 1px;
            background: var(--border-color);
            margin: 8px 0;
        }
        
        .user-info {
            cursor: default;
            padding: 15px 20px;
            background: #f8fafc;
            border-radius: 8px;
            margin: 0 10px 10px;
        }
        
        .user-info:hover {
            background: #f8fafc !important;
        }
        
        .user-bio {
            font-size: 13px;
            color: var(--light-text-color);
            margin-top: 6px;
            line-height: 1.4;
            max-height: 40px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        /* Search Bar - Only on Home Page */
        .search-container {
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            padding: 15px 0;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .search-container.show {
            display: block;
            opacity: 1;
        }
        
        .search-box {
            display: flex;
            align-items: center;
            background: #f1f3f4;
            border-radius: 24px;
            padding: 8px 16px;
            transition: all 0.3s;
            border: 1px solid transparent;
            max-width: 1200px;
            margin: 0 auto;
            width: calc(100% - 40px);
        }
        
        .search-box:focus-within {
            background: white;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(26, 35, 126, 0.2);
        }
        
        .search-box i {
            color: var(--light-text-color);
            margin-right: 10px;
        }
        
        .search-input {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 16px;
            font-family: 'Hind', sans-serif;
            outline: none;
        }
        
        .search-input::placeholder {
            color: var(--light-text-color);
        }
        
        /* Auth Modal Styles */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .auth-modal.active {
            display: flex;
        }
        
        .auth-container {
            background: white;
            border-radius: 12px;
            padding: 25px;
            width: 100%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 1px solid var(--border-color);
            position: relative;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .auth-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: var(--light-text-color);
            transition: all 0.3s;
        }
        
        .auth-tab.active {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            margin-bottom: -2px;
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }
        
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            font-family: 'Hind', sans-serif;
            background: white;
        }
        
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            border-color: var(--primary-color);
            outline: none;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .form-group select {
            cursor: pointer;
        }
        
        .auth-submit {
            width: 100%;
            padding: 12px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s;
        }
        
        .auth-submit:hover {
            background: var(--primary-dark);
        }
        
        .auth-switch {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: var(--light-text-color);
        }
        
        .auth-switch a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
        }
        
        .close-auth {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 20px;
            color: var(--light-text-color);
            cursor: pointer;
            z-index: 1;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s;
        }
        
        .close-auth:hover {
            background: #f1f3f4;
        }
        
        /* Edit Profile Modal */
        .edit-profile-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            overflow-y: auto;
        }
        
        .edit-profile-modal.active {
            display: flex;
        }
        
        .edit-profile-container {
            background: white;
            border-radius: 12px;
            padding: 25px;
            width: 100%;
            max-width: 450px;
            margin: 20px auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            border: 1px solid var(--border-color);
        }
        
        .edit-profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .edit-profile-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-color);
            margin: 0;
        }
        
        .close-edit-profile {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--light-text-color);
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s;
        }
        
        .close-edit-profile:hover {
            background: #f1f3f4;
        }
        
        .profile-picture-section {
            text-align: center;
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        
        .profile-picture {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            font-weight: 600;
            margin: 0 auto 10px;
            border: 3px solid var(--border-color);
            overflow: hidden;
        }
        
        .profile-picture img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .change-photo-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        
        /* Back Button for Edit Profile */
        .back-button {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 6px;
            transition: background 0.3s;
        }
        
        .back-button:hover {
            background: #f0f5ff;
        }
        
        /* Content Pages Styles */
        .content-page {
            display: none;
            flex-grow: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 20px 15px;
            padding-bottom: 80px;
            background-color: var(--background-color);
        }
        
        .content-page.active {
            display: block;
        }
        
        .content-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .content-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            margin: 0;
        }
        
        .content-body {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }
        
        .content-section {
            margin-bottom: 30px;
        }
        
        .content-section:last-child {
            margin-bottom: 0;
        }
        
        .content-section h2 {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .content-section p {
            margin-bottom: 15px;
            line-height: 1.7;
        }
        
        .content-section ul, .content-section ol {
            margin-bottom: 15px;
            padding-left: 25px;
        }
        
        .content-section li {
            margin-bottom: 8px;
            line-height: 1.6;
        }
        
        /* Feedback Form Styles */
        .feedback-form {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .feedback-form .form-group {
            margin-bottom: 20px;
        }
        
        .feedback-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }
        
        .feedback-form input, .feedback-form textarea, .feedback-form select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            font-family: 'Hind', sans-serif;
            background: white;
        }
        
        .feedback-form input:focus, .feedback-form textarea:focus, .feedback-form select:focus {
            border-color: var(--primary-color);
            outline: none;
        }
        
        .feedback-form textarea {
            resize: vertical;
            min-height: 120px;
        }
        
        .feedback-submit {
            width: 100%;
            padding: 12px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s;
        }
        
        .feedback-submit:hover {
            background: var(--primary-dark);
        }
        
        .feedback-success {
            display: none;
            text-align: center;
            padding: 30px;
            background: #f0f9f0;
            border-radius: 8px;
            border: 1px solid var(--success-color);
            margin-top: 20px;
        }
        
        .feedback-success.show {
            display: block;
        }
        
        .feedback-success i {
            font-size: 48px;
            color: var(--success-color);
            margin-bottom: 15px;
        }
        
        .feedback-success h3 {
            font-size: 20px;
            color: var(--success-color);
            margin-bottom: 10px;
        }
        
        #app-container {
            flex-grow: 1;
            position: relative;
        }
        
        .screen {
            display: block;
            flex-grow: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 20px 15px;
            padding-bottom: 80px;
        }

        .home-section h1 {
            font-size: 26px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
            text-align: center;
        }
        
        .subtitle {
            font-size: 14px;
            color: var(--light-text-color);
            text-align: center;
            margin-bottom: 25px;
        }

        .category-menu {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            gap: 10px;
            padding: 5px 0 15px 0;
            margin-bottom: 10px;
            -webkit-overflow-scrolling: touch;
        }
        
        .category-button {
            flex-shrink: 0;
            background-color: var(--card-background);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 10px 18px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .category-button.active-cat {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .link-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 15px; 
        }
        
        .link-card { 
            background-color: var(--card-background); 
            border-radius: var(--border-radius); 
            padding: 20px; 
            box-shadow: var(--shadow); 
            display: flex; 
            flex-direction: column;
            text-decoration: none;
            color: var(--text-color);
            height: 100%;
            border-left: 5px solid var(--primary-color);
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid var(--border-color);
        }
        
        .link-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.12);
        }
        
        .link-card:active {
            transform: scale(0.98);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .card-logo {
            width: 40px;
            height: 40px;
            object-fit: contain;
            border-radius: 8px;
            margin-right: 15px;
            border: 1px solid var(--border-color);
        }
        
        .fallback-text {
            display: none;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            margin-right: 15px;
            border: 1px solid var(--border-color);
            background: var(--primary-color);
            color: white;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }
        
        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary-color);
            margin: 0;
        }
        
        .card-description {
            font-size: 13px;
            color: var(--light-text-color);
            margin: 0;
        }

        .ad-card {
            background-color: #FFFDE7;
            border-left: 5px solid var(--warning-color);
            text-align: center;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-decoration: none;
            color: var(--text-color);
            box-shadow: var(--shadow);
            border-radius: var(--border-radius);
            transition: transform 0.3s;
            border: 1px solid var(--border-color);
        }
        
        .ad-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.12);
        }
        
        .ad-card:active {
            transform: scale(0.98);
        }
        
        .ad-card-title {
            color: var(--text-color);
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .ad-card-image {
            max-width: 100%;
            height: auto;
            border-radius: 6px;
            max-height: 120px;
            object-fit: cover;
        }
        
        .ad-label-small {
            font-size: 10px;
            color: var(--warning-color);
            text-transform: uppercase;
            margin-top: 5px;
            font-weight: 600;
        }

        /* Adsterra Ad Placeholders */
        .adsterra-ad {
            background: #f9f9f9;
            border: 1px dashed #ccc;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            margin: 15px 0;
            color: #666;
        }
        
        .adsterra-ad-header {
            grid-column: 1 / -1;
            margin-bottom: 10px;
        }
        
        .adsterra-ad-between {
            grid-column: 1 / -1;
            margin: 10px 0;
        }

        /* Updated Toast Notification */
        #toast-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background-color: #000000;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 10000;
            font-size: 14px;
            font-weight: 500;
            max-width: 90%;
            text-align: center;
        }
        
        #toast-notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        
        /* Confirmation Modal */
        .confirmation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .confirmation-modal.active {
            display: flex;
        }
        
        .confirmation-container {
            background: white;
            border-radius: 12px;
            padding: 25px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 1px solid var(--border-color);
            text-align: center;
        }
        
        .confirmation-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 15px;
        }
        
        .confirmation-message {
            font-size: 16px;
            color: var(--light-text-color);
            margin-bottom: 25px;
        }
        
        .confirmation-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .confirmation-btn {
            padding: 10px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
            flex: 1;
        }
        
        .confirmation-cancel {
            background: #f1f3f4;
            color: var(--text-color);
        }
        
        .confirmation-cancel:hover {
            background: #e8eaed;
        }
        
        .confirmation-confirm {
            background: var(--danger-color);
            color: white;
        }
        
        .confirmation-confirm:hover {
            background: #d33426;
        }
        
        /* Loading Spinner */
        #loading-spinner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        #loading-spinner.show {
            display: flex;
        }
        
        .spinner-icon {
            font-size: 40px;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .spinner-text {
            font-size: 16px;
            color: var(--text-color);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--light-text-color);
            grid-column: 1 / -1;
        }
        
        .empty-state i {
            font-size: 48px;
            color: var(--border-color);
            margin-bottom: 15px;
        }
        
        /* Footer */
        .app-footer {
            background: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
            margin-top: auto;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .footer-link {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            font-size: 14px;
            transition: color 0.3s;
        }
        
        .footer-link:hover {
            color: white;
        }
        
        .copyright {
            font-size: 12px;
            color: rgba(255,255,255,0.7);
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .link-grid {
                grid-template-columns: 1fr;
            }
            
            .app-name {
                font-size: 16px;
            }
            
            .app-tagline {
                font-size: 9px;
            }
            
            .header-controls {
                gap: 10px;
            }
            
            .auth-button {
                padding: 6px 15px;
                font-size: 11px;
            }
            
            .language-button, .profile-btn {
                width: 32px;
                height: 32px;
                font-size: 12px;
            }
            
            .language-dropdown {
                min-width: 130px;
                right: -10px;
            }
            
            .profile-dropdown {
                min-width: 200px;
                right: -10px;
            }
            
            .auth-container, .edit-profile-container {
                padding: 20px;
                margin: 10px;
            }
            
            .edit-profile-modal {
                padding: 10px;
                align-items: flex-start;
            }
            
            .edit-profile-container {
                margin-top: 10px;
                margin-bottom: 10px;
            }
            
            .profile-picture {
                width: 70px;
                height: 70px;
                font-size: 24px;
            }
            
            .footer-links {
                gap: 15px;
            }
            
            .footer-link {
                font-size: 13px;
            }
            
            .confirmation-buttons {
                flex-direction: column;
            }
            
            .content-body {
                padding: 20px;
            }
            
            .content-title {
                font-size: 22px;
            }
        }

        @media (max-width: 480px) {
            .app-header {
                padding: 12px 15px;
            }
            
            .logo-section {
                gap: 8px;
            }
            
            .app-logo {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
            
            .app-name {
                font-size: 14px;
            }
            
            .app-tagline {
                font-size: 8px;
            }
            
            .auth-container, .edit-profile-container {
                padding: 15px;
                margin: 5px;
            }
            
            .edit-profile-header {
                margin-bottom: 15px;
            }
            
            .edit-profile-title {
                font-size: 18px;
            }
            
            .form-group {
                margin-bottom: 15px;
            }
            
            .form-group input, .form-group textarea, .form-group select {
                padding: 10px;
                font-size: 14px;
            }
            
            .auth-submit {
                padding: 10px;
                font-size: 14px;
            }
            
            .language-dropdown {
                min-width: 120px;
                right: -15px;
            }
            
            .profile-dropdown {
                min-width: 180px;
                right: -15px;
            }
            
            .user-bio {
                font-size: 11px;
                -webkit-line-clamp: 3;
                max-height: 42px;
            }
            
            .profile-picture {
                width: 60px;
                height: 60px;
                font-size: 20px;
            }
            
            .footer-links {
                flex-direction: column;
                gap: 10px;
            }
            
            .content-body {
                padding: 15px;
            }
            
            .content-title {
                font-size: 20px;
            }
        }

        @media (max-width: 360px) {
            .auth-container, .edit-profile-container {
                padding: 12px;
            }
            
            .edit-profile-title {
                font-size: 16px;
            }
            
            .profile-picture {
                width: 50px;
                height: 50px;
                font-size: 18px;
            }
            
            .form-group input, .form-group textarea, .form-group select {
                padding: 8px;
                font-size: 13px;
            }
            
            .content-body {
                padding: 12px;
            }
        }

        @media (max-width: 320px) {
            .app-header {
                padding: 10px 12px;
            }
            
            .app-logo {
                width: 30px;
                height: 30px;
                font-size: 14px;
            }
            
            .app-name {
                font-size: 12px;
            }
            
            .auth-button {
                padding: 5px 12px;
                font-size: 10px;
            }
            
            .search-input {
                font-size: 14px;
            }
        }

        /* Touch device improvements */
        @media (hover: none) and (pointer: coarse) {
            .link-card:hover {
                transform: none;
            }
            
            .category-button:hover {
                transform: none;
            }
            
            .auth-button:hover {
                transform: none;
            }
        }

        /* Prevent body scroll when modal is open */
        body.modal-open {
            overflow: hidden;
        }
        
        /* Hindi Font Support */
        .hindi-text {
            font-family: 'Hind', sans-serif;
        }
        
        /* Input validation styles */
        .input-error {
            border-color: var(--danger-color) !important;
            box-shadow: 0 0 0 2px rgba(234, 67, 53, 0.2) !important;
        }
        
        .error-message {
            color: var(--danger-color);
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        
        .error-message.show {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Tricolor Strip -->
    <div class="tricolor-strip"></div>
    
    <!-- Header with Consistent Blue Background -->
    <header class="app-header">
        <div class="header-content">
            <div class="logo-section">
                <div class="app-logo">
                    <span style="display:flex; width:100%; height:100%; align-items:center; justify-content:center;">सा</span>
                </div>
                <div>
                    <div class="app-name">Saral Sahayata</div>
                    <div class="app-tagline">सरकारी सेवाओं का एक मंच</div>
                </div>
            </div>
            
            <div class="header-controls">
                <!-- Single Auth Button (Visible when not logged in) -->
                <button class="auth-button" id="auth-btn">
                    <i class="fas fa-user"></i>
                    <span id="auth-btn-text">साइन अप / लॉग इन</span>
                </button>
                
                <!-- Language Button -->
                <div class="language-section" id="language-section">
                    <button class="language-button" id="language-btn">
                        <i class="fas fa-globe"></i>
                    </button>
                    <div class="language-dropdown" id="language-dropdown">
                        <button class="language-option active" data-lang="hi">
                            <i class="fas fa-check"></i>
                            <span>हिन्दी</span>
                        </button>
                        <button class="language-option" data-lang="en">
                            <i class="fas fa-check" style="visibility: hidden;"></i>
                            <span>English</span>
                        </button>
                    </div>
                </div>
                
                <!-- Profile Section (Visible when logged in) -->
                <div class="profile-section" id="profile-section">
                    <button class="profile-btn" id="profile-btn">
                        <!-- Profile picture letter will be inserted here by JavaScript -->
                    </button>
                    <div class="profile-dropdown" id="profile-dropdown">
                        <div class="dropdown-item user-info">
                            <div class="profile-picture-small">
                                <!-- Small profile picture in dropdown -->
                            </div>
                            <div>
                                <div id="user-name">उपयोगकर्ता नाम</div>
                                <div id="user-email" style="color: var(--light-text-color); font-size: 12px;">user@email.com</div>
                                <div id="user-bio" class="user-bio"></div>
                            </div>
                        </div>
                        <div class="dropdown-divider"></div>
                        <button class="dropdown-item" id="edit-profile-btn">
                            <i class="fas fa-user-edit"></i>
                            <span>प्रोफाइल संपादित करें</span>
                        </button>
                        <button class="dropdown-item" id="privacy-policy-btn">
                            <i class="fas fa-shield-alt"></i>
                            <span>गोपनीयता नीति</span>
                        </button>
                        <button class="dropdown-item" id="terms-service-btn">
                            <i class="fas fa-file-contract"></i>
                            <span>नियम और सेवाएं</span>
                        </button>
                        <!-- NEW: About Button added below Terms & Service -->
                        <button class="dropdown-item" id="about-btn">
                            <i class="fas fa-info-circle"></i>
                            <span>हमारे बारे में</span>
                        </button>
                        <button class="dropdown-item" id="feedback-support-btn">
                            <i class="fas fa-headset"></i>
                            <span>प्रतिक्रिया और सहायता</span>
                        </button>
                        <button class="dropdown-item" id="whatsapp-channel-btn">
                            <i class="fab fa-whatsapp"></i>
                            <span>व्हाट्सएप जुड़ें</span>
                        </button>
                        <div class="dropdown-divider"></div>
                        <button class="dropdown-item" id="logout-btn">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>लॉगआउट</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Search Bar - Only on Home Page -->
    <div class="search-container" id="search-container">
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" class="search-input" id="search-input" placeholder="सेवाएं खोजें...">
        </div>
    </div>

    <!-- Auth Modal -->
    <div class="auth-modal" id="auth-modal">
        <div class="auth-container">
            <button class="close-auth" id="close-auth">&times;</button>
            
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">लॉग इन</button>
                <button class="auth-tab" data-tab="signup">साइन अप</button>
            </div>
            
            <!-- Login Form -->
            <form class="auth-form active" id="login-form">
                <div class="form-group">
                    <label for="login-email">ईमेल</label>
                    <input type="email" id="login-email" required placeholder="अपना ईमेल दर्ज करें">
                </div>
                
                <div class="form-group">
                    <label for="login-password">पासवर्ड</label>
                    <input type="password" id="login-password" required placeholder="अपना पासवर्ड दर्ज करें (न्यूनतम 6 वर्ण)">
                    <div class="error-message" id="login-password-error"></div>
                </div>
                
                <button type="submit" class="auth-submit">लॉग इन करें</button>
                
                <div class="auth-switch">
                    खाता नहीं है? <a id="switch-to-signup">साइन अप करें</a>
                </div>
            </form>
            
            <!-- Signup Form -->
            <form class="auth-form" id="signup-form">
                <div class="form-group">
                    <label for="signup-name">पूरा नाम</label>
                    <input type="text" id="signup-name" required placeholder="अपना पूरा नाम दर्ज करें">
                </div>
                
                <div class="form-group">
                    <label for="signup-email">ईमेल</label>
                    <input type="email" id="signup-email" required placeholder="अपना ईमेल दर्ज करें">
                </div>
                
                <div class="form-group">
                    <label for="signup-password">पासवर्ड</label>
                    <input type="password" id="signup-password" required placeholder="पासवर्ड बनाएं (न्यूनतम 6 वर्ण)">
                    <div class="error-message" id="signup-password-error"></div>
                </div>
                
                <div class="form-group">
                    <label for="signup-phone">फोन नंबर</label>
                    <input type="tel" id="signup-phone" placeholder="अपना फोन नंबर दर्ज करें" maxlength="10">
                    <div class="error-message" id="signup-phone-error"></div>
                </div>
                
                <button type="submit" class="auth-submit">खाता बनाएं</button>
                
                <div class="auth-switch">
                    पहले से खाता है? <a id="switch-to-login">लॉग इन करें</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="edit-profile-modal" id="edit-profile-modal">
        <div class="edit-profile-container">
            <div class="edit-profile-header">
                <button class="back-button" id="back-edit-profile">
                    <i class="fas fa-arrow-left"></i>
                    <span>वापस</span>
                </button>
                <h2 class="edit-profile-title">प्रोफाइल संपादित करें</h2>
                <button class="close-edit-profile" id="close-edit-profile">&times;</button>
            </div>
            
            <div class="profile-picture-section">
                <div class="profile-picture" id="profile-picture">
                    <span id="profile-initials" style="display:flex; width:100%; height:100%; align-items:center; justify-content:center;">U</span>
                </div>
                <button class="change-photo-btn" id="change-photo-btn">फोटो बदलें</button>
            </div>
            
            <form id="edit-profile-form">
                <div class="form-group">
                    <label for="edit-name">पूरा नाम</label>
                    <input type="text" id="edit-name" required placeholder="अपना पूरा नाम दर्ज करें">
                </div>
                
                <div class="form-group">
                    <label for="edit-email">ईमेल</label>
                    <input type="email" id="edit-email" required placeholder="अपना ईमेल दर्ज करें" readonly>
                </div>
                
                <div class="form-group">
                    <label for="edit-phone">फोन नंबर</label>
                    <input type="tel" id="edit-phone" placeholder="अपना फोन नंबर दर्ज करें" maxlength="10">
                    <div class="error-message" id="edit-phone-error"></div>
                </div>
                
                <div class="form-group">
                    <label for="edit-gender">लिंग</label>
                    <select id="edit-gender">
                        <option value="">लिंग चुनें</option>
                        <option value="male">पुरुष</option>
                        <option value="female">महिला</option>
                        <option value="other">अन्य</option>
                        <option value="prefer-not-to-say">बताना पसंद नहीं</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="edit-bio">बायो</label>
                    <textarea id="edit-bio" placeholder="अपने बारे में बताएं (अधिकतम 150 वर्ण)" maxlength="150"></textarea>
                    <div style="text-align: right; font-size: 12px; color: var(--light-text-color); margin-top: 5px;">
                        <span id="bio-counter">0</span>/150 वर्ण
                    </div>
                </div>
                
                <button type="submit" class="auth-submit">परिवर्तन सहेजें</button>
            </form>
        </div>
    </div>

    <!-- Logout Confirmation Modal -->
    <div class="confirmation-modal" id="logout-confirmation-modal">
        <div class="confirmation-container">
            <h3 class="confirmation-title">लॉगआउट पुष्टि</h3>
            <p class="confirmation-message">क्या आप वाकई लॉगआउट करना चाहते हैं?</p>
            <div class="confirmation-buttons">
                <button class="confirmation-btn confirmation-cancel" id="logout-cancel">रद्द करें</button>
                <button class="confirmation-btn confirmation-confirm" id="logout-confirm">हाँ, लॉगआउट करें</button>
            </div>
        </div>
    </div>

    <!-- Content Pages -->
    <!-- Privacy Policy Page -->
    <div id="privacy-policy-page" class="content-page">
        <div class="content-header">
            <button class="back-button" id="back-privacy-policy">
                <i class="fas fa-arrow-left"></i>
                <span>वापस</span>
            </button>
            <h1 class="content-title">गोपनीयता नीति</h1>
        </div>
        <div class="content-body" id="privacy-policy-content">
            <!-- Content will be loaded from Firebase -->
            <div class="content-section">
                <h2>गोपनीयता नीति लोड हो रही है...</h2>
                <p>कृपया प्रतीक्षा करें जब तक हम गोपनीयता नीति सामग्री लोड करते हैं।</p>
            </div>
        </div>
    </div>

    <!-- Terms & Service Page -->
    <div id="terms-service-page" class="content-page">
        <div class="content-header">
            <button class="back-button" id="back-terms-service">
                <i class="fas fa-arrow-left"></i>
                <span>वापस</span>
            </button>
            <h1 class="content-title">नियम और सेवाएं</h1>
        </div>
        <div class="content-body" id="terms-service-content">
            <!-- Content will be loaded from Firebase -->
            <div class="content-section">
                <h2>नियम और सेवाएं लोड हो रही हैं...</h2>
                <p>कृपया प्रतीक्षा करें जब तक हम नियम और सेवा सामग्री लोड करते हैं।</p>
            </div>
        </div>
    </div>

    <!-- About Page -->
    <div id="about-page" class="content-page">
        <div class="content-header">
            <button class="back-button" id="back-about">
                <i class="fas fa-arrow-left"></i>
                <span>वापस</span>
            </button>
            <h1 class="content-title">Saral Sahayata के बारे में</h1>
        </div>
        <div class="content-body" id="about-content">
            <!-- Content will be loaded from Firebase -->
            <div class="content-section">
                <h2>जानकारी लोड हो रही है...</h2>
                <p>कृपया प्रतीक्षा करें जब तक हम सामग्री लोड करते हैं।</p>
            </div>
        </div>
    </div>

    <!-- Feedback & Support Page -->
    <div id="feedback-support-page" class="content-page">
        <div class="content-header">
            <button class="back-button" id="back-feedback-support">
                <i class="fas fa-arrow-left"></i>
                <span>वापस</span>
            </button>
            <h1 class="content-title">प्रतिक्रिया और सहायता</h1>
        </div>
        <div class="content-body">
            <div class="content-section">
                <h2>हम आपकी प्रतिक्रिया को महत्व देते हैं</h2>
                <p>आपकी प्रतिक्रिया हमारे लिए महत्वपूर्ण है क्योंकि हम लगातार Saral Sahayata को सुधारने और नागरिकों को बेहतर सेवाएं प्रदान करने के लिए काम कर रहे हैं। कृपया अपने सुझाव साझा करें, समस्याओं की रिपोर्ट करें, या हमें अपने अनुभव के बारे में बताएं।</p>
            </div>
            
            <div class="content-section">
                <h2>प्रतिक्रिया सबमिट करें</h2>
                <form id="feedback-form" class="feedback-form">
                    <div class="form-group">
                        <label for="feedback-name">पूरा नाम</label>
                        <input type="text" id="feedback-name" required placeholder="अपना पूरा नाम दर्ज करें">
                    </div>
                    
                    <div class="form-group">
                        <label for="feedback-email">ईमेल पता</label>
                        <input type="email" id="feedback-email" required placeholder="अपना ईमेल पता दर्ज करें">
                    </div>
                    
                    <div class="form-group">
                        <label for="feedback-phone">फोन नंबर (वैकल्पिक)</label>
                        <input type="tel" id="feedback-phone" placeholder="अपना फोन नंबर दर्ज करें" maxlength="10">
                    </div>
                    
                    <div class="form-group">
                        <label for="feedback-type">प्रतिक्रिया प्रकार</label>
                        <select id="feedback-type" required>
                            <option value="">प्रतिक्रिया प्रकार चुनें</option>
                            <option value="suggestion">सुझाव</option>
                            <option value="bug">बग रिपोर्ट</option>
                            <option value="complaint">शिकायत</option>
                            <option value="compliment">प्रशंसा</option>
                            <option value="general">सामान्य प्रतिक्रिया</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="feedback-subject">विषय</label>
                        <input type="text" id="feedback-subject" required placeholder="अपनी प्रतिक्रिया का विषय दर्ज करें">
                    </div>
                    
                    <div class="form-group">
                        <label for="feedback-message">संदेश</label>
                        <textarea id="feedback-message" required placeholder="कृपया अपनी प्रतिक्रिया विस्तार से वर्णित करें" minlength="10"></textarea>
                    </div>
                    
                    <button type="submit" class="feedback-submit">प्रतिक्रिया सबमिट करें</button>
                </form>
                
                <div id="feedback-success" class="feedback-success">
                    <i class="fas fa-check-circle"></i>
                    <h3>धन्यवाद!</h3>
                    <p>आपकी प्रतिक्रिया सफलतापूर्वक सबमिट कर दी गई है। हम आपके इनपुट की सराहना करते हैं और इसे जल्द ही समीक्षा करेंगे।</p>
                </div>
            </div>
            
            <div class="content-section">
                <h2>सहायता चैनल</h2>
                <p>यदि आपको तत्काल सहायता की आवश्यकता है, तो आप निम्नलिखित चैनलों के माध्यम से हमसे संपर्क कर सकते हैं:</p>
                <ul>
                    <li><strong>ईमेल सहायता:</strong> support@saralsahayata.gov.in</li>
                    <li><strong>फोन सहायता:</strong> 155XXX (टोल-फ्री, सुबह 9 बजे से शाम 6 बजे तक उपलब्ध)</li>
                    <li><strong>व्हाट्सएप सहायता:</strong> +91-XXXXXXXXXX</li>
                    <li><strong>व्यक्तिगत सहायता:</strong> अपने नजदीकी कॉमन सर्विस सेंटर (CSC) पर जाएं</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="app-container">
        <main>
            <div id="home-screen" class="screen">
                <div class="home-section">
                   
                    <!-- Adsterra Header Ad Placeholder -->
                    <div class="adsterra-ad adsterra-ad-header" id="header-ad">
                        <p>विज्ञापन स्थान - Adsterra कोड यहाँ</p>
                    </div>
                    
                    <div class="category-menu" id="category-menu">
                        <!-- Categories will be loaded here -->
                    </div>

                    <div class="link-grid" id="link-grid">
                        <!-- Links and ads will be loaded here -->
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    
    <!-- Loading Spinner -->
    <div id="loading-spinner">
        <i class="fas fa-spinner fa-spin spinner-icon"></i>
        <p class="spinner-text">लोड हो रहा है...</p>
    </div>

    <!-- Updated Toast Notification with Black Background -->
    <div id="toast-notification" role="alert">
        <i id="toast-icon"></i>
        <span id="toast-text"></span>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

    <script>
        // Language Management
        const translations = {
            hi: {
                // Header
                appName: "Saral Sahayata",
                appTagline: "सरकारी सेवाओं का एक मंच",
                authButton: "साइन अप / लॉग इन",
                
                // Search
                searchPlaceholder: "सेवाएं खोजें...",
                
                // Categories
                categories: {
                    'all': 'सभी सेवाएं',
                    'job': 'नौकरी और करियर',
                    'student': 'छात्र और शिक्षा',
                    'utility': 'सरकारी योजनाएं',
                    'health': 'स्वास्थ्य सेवाएं',
                    'finance': 'वित्त और बैंकिंग',
                    'agriculture': 'कृषि सेवाएं',
                    'travel': 'यात्रा और परिवहन',
                    'legal': 'कानूनी सेवाएं'
                },
                
                // Auth Modal
                loginTab: "लॉग इन",
                signupTab: "साइन अप",
                loginEmail: "ईमेल",
                loginEmailPlaceholder: "अपना ईमेल दर्ज करें",
                loginPassword: "पासवर्ड",
                loginPasswordPlaceholder: "अपना पासवर्ड दर्ज करें (न्यूनतम 6 वर्ण)",
                loginSubmit: "लॉग इन करें",
                loginSwitch: "खाता नहीं है?",
                signupLink: "साइन अप करें",
                signupName: "पूरा नाम",
                signupNamePlaceholder: "अपना पूरा नाम दर्ज करें",
                signupEmail: "ईमेल",
                signupEmailPlaceholder: "अपना ईमेल दर्ज करें",
                signupPassword: "पासवर्ड",
                signupPasswordPlaceholder: "पासवर्ड बनाएं (न्यूनतम 6 वर्ण)",
                signupPhone: "फोन नंबर",
                signupPhonePlaceholder: "अपना फोन नंबर दर्ज करें",
                signupSubmit: "खाता बनाएं",
                signupSwitch: "पहले से खाता है?",
                loginLink: "लॉग इन करें",
                
                // Profile Dropdown
                editProfile: "प्रोफाइल संपादित करें",
                privacyPolicy: "गोपनीयता नीति",
                termsService: "नियम और सेवाएं",
                about: "हमारे बारे में",
                feedbackSupport: "प्रतिक्रिया और सहायता",
                whatsappChannel: "व्हाट्सएप जुड़ें",
                logout: "लॉगआउट",
                
                // Edit Profile
                editProfileTitle: "प्रोफाइल संपादित करें",
                changePhoto: "फोटो बदलें",
                fullName: "पूरा नाम",
                fullNamePlaceholder: "अपना पूरा नाम दर्ज करें",
                email: "ईमेल",
                emailPlaceholder: "अपना ईमेल दर्ज करें",
                phone: "फोन नंबर",
                phonePlaceholder: "अपना फोन नंबर दर्ज करें",
                gender: "लिंग",
                selectGender: "लिंग चुनें",
                male: "पुरुष",
                female: "महिला",
                other: "अन्य",
                preferNotToSay: "बताना पसंद नहीं",
                bio: "बायो",
                bioPlaceholder: "अपने बारे में बताएं (अधिकतम 150 वर्ण)",
                saveChanges: "परिवर्तन सहेजें",
                back: "वापस",
                
                // Content Pages
                privacyPolicyTitle: "गोपनीयता नीति",
                termsServiceTitle: "नियम और सेवाएं",
                aboutTitle: "Saral Sahayata के बारे में",
                feedbackSupportTitle: "प्रतिक्रिया और सहायता",
                
                // Feedback Form
                feedbackTitle: "हम आपकी प्रतिक्रिया को महत्व देते हैं",
                feedbackDescription: "आपकी प्रतिक्रिया हमारे लिए महत्वपूर्ण है क्योंकि हम लगातार Saral Sahayata को सुधारने और नागरिकों को बेहतर सेवाएं प्रदान करने के लिए काम कर रहे हैं। कृपया अपने सुझाव साझा करें, समस्याओं की रिपोर्ट करें, या हमें अपने अनुभव के बारे में बताएं।",
                submitFeedback: "प्रतिक्रिया सबमिट करें",
                fullNameLabel: "पूरा नाम",
                fullNamePlaceholderFeedback: "अपना पूरा नाम दर्ज करें",
                emailLabel: "ईमेल पता",
                emailPlaceholderFeedback: "अपना ईमेल पता दर्ज करें",
                phoneLabel: "फोन नंबर (वैकल्पिक)",
                phonePlaceholderFeedback: "अपना फोन नंबर दर्ज करें",
                feedbackType: "प्रतिक्रिया प्रकार",
                selectFeedbackType: "प्रतिक्रिया प्रकार चुनें",
                suggestion: "सुझाव",
                bug: "बग रिपोर्ट",
                complaint: "शिकायत",
                compliment: "प्रशंसा",
                general: "सामान्य प्रतिक्रिया",
                subject: "विषय",
                subjectPlaceholder: "अपनी प्रतिक्रिया का विषय दर्ज करें",
                message: "संदेश",
                messagePlaceholder: "कृपया अपनी प्रतिक्रिया विस्तार से वर्णित करें",
                submit: "प्रतिक्रिया सबमिट करें",
                feedbackSuccess: "धन्यवाद!",
                feedbackSuccessMessage: "आपकी प्रतिक्रिया सफलतापूर्वक सबमिट कर दी गई है। हम आपके इनपुट की सराहना करते हैं और इसे जल्द ही समीक्षा करेंगे।",
                supportChannels: "सहायता चैनल",
                supportDescription: "यदि आपको तत्काल सहायता की आवश्यकता है, तो आप निम्नलिखित चैनलों के माध्यम से हमसे संपर्क कर सकते हैं:",
                emailSupport: "ईमेल सहायता:",
                phoneSupport: "फोन सहायता:",
                whatsappSupport: "व्हाट्सएप सहायता:",
                inPersonSupport: "व्यक्तिगत सहायता:",
                
                // Toast Messages
                welcome: "Saral Sahayata में आपका स्वागत है!",
                loginSuccess: "लॉगिन सफल!",
                signupSuccess: "खाता सफलतापूर्वक बन गया!",
                logoutSuccess: "सफलतापूर्वक लॉगआउट हो गए!",
                profileUpdateSuccess: "प्रोफाइल सफलतापूर्वक सहेजी गई!",
                feedbackSuccessToast: "प्रतिक्रिया सफलतापूर्वक सबमिट हो गई!",
                languageChanged: "भाषा बदल गई!",
                
                // Loading
                loading: "लोड हो रहा है...",
                
                // Logout Confirmation
                logoutConfirmTitle: "लॉगआउट पुष्टि",
                logoutConfirmMessage: "क्या आप वाकई लॉगआउट करना चाहते हैं?",
                cancel: "रद्द करें",
                confirmLogout: "हाँ, लॉगआउट करें"
            },
            en: {
                // Header
                appName: "Saral Sahayata",
                appTagline: "A Platform for Government Services",
                authButton: "Sign Up / Log In",
                
                // Search
                searchPlaceholder: "Search services...",
                
                // Categories
                categories: {
                    'all': 'All Services',
                    'job': 'Jobs & Career',
                    'student': 'Students & Education',
                    'utility': 'Government Schemes',
                    'health': 'Health Services',
                    'finance': 'Finance & Banking',
                    'agriculture': 'Agriculture Services',
                    'travel': 'Travel & Transport',
                    'legal': 'Legal Services'
                },
                
                // Auth Modal
                loginTab: "Log In",
                signupTab: "Sign Up",
                loginEmail: "Email",
                loginEmailPlaceholder: "Enter your email",
                loginPassword: "Password",
                loginPasswordPlaceholder: "Enter your password (min. 6 characters)",
                loginSubmit: "Log In",
                loginSwitch: "Don't have an account?",
                signupLink: "Sign Up",
                signupName: "Full Name",
                signupNamePlaceholder: "Enter your full name",
                signupEmail: "Email",
                signupEmailPlaceholder: "Enter your email",
                signupPassword: "Password",
                signupPasswordPlaceholder: "Create a password (min. 6 characters)",
                signupPhone: "Phone Number",
                signupPhonePlaceholder: "Enter your phone number",
                signupSubmit: "Create Account",
                signupSwitch: "Already have an account?",
                loginLink: "Log In",
                
                // Profile Dropdown
                editProfile: "Edit Profile",
                privacyPolicy: "Privacy Policy",
                termsService: "Terms & Service",
                about: "About",
                feedbackSupport: "Feedback & Support",
                whatsappChannel: "Join WhatsApp",
                logout: "Logout",
                
                // Edit Profile
                editProfileTitle: "Edit Profile",
                changePhoto: "Change Photo",
                fullName: "Full Name",
                fullNamePlaceholder: "Enter your full name",
                email: "Email",
                emailPlaceholder: "Enter your email",
                phone: "Phone Number",
                phonePlaceholder: "Enter your phone number",
                gender: "Gender",
                selectGender: "Select Gender",
                male: "Male",
                female: "Female",
                other: "Other",
                preferNotToSay: "Prefer not to say",
                bio: "Bio",
                bioPlaceholder: "Tell us about yourself (max 150 characters)",
                saveChanges: "Save Changes",
                back: "Back",
                
                // Content Pages
                privacyPolicyTitle: "Privacy Policy",
                termsServiceTitle: "Terms & Service",
                aboutTitle: "About Saral Sahayata",
                feedbackSupportTitle: "Feedback & Support",
                
                // Feedback Form
                feedbackTitle: "We Value Your Feedback",
                feedbackDescription: "Your feedback is important to us as we continuously work to improve Saral Sahayata and provide better services to citizens. Please share your suggestions, report issues, or let us know about your experience using our platform.",
                submitFeedback: "Submit Feedback",
                fullNameLabel: "Full Name",
                fullNamePlaceholderFeedback: "Enter your full name",
                emailLabel: "Email Address",
                emailPlaceholderFeedback: "Enter your email address",
                phoneLabel: "Phone Number (Optional)",
                phonePlaceholderFeedback: "Enter your phone number",
                feedbackType: "Feedback Type",
                selectFeedbackType: "Select feedback type",
                suggestion: "Suggestion",
                bug: "Bug Report",
                complaint: "Complaint",
                compliment: "Compliment",
                general: "General Feedback",
                subject: "Subject",
                subjectPlaceholder: "Enter subject of your feedback",
                message: "Message",
                messagePlaceholder: "Please describe your feedback in detail",
                submit: "Submit Feedback",
                feedbackSuccess: "Thank You!",
                feedbackSuccessMessage: "Your feedback has been submitted successfully. We appreciate your input and will review it shortly.",
                supportChannels: "Support Channels",
                supportDescription: "If you need immediate assistance, you can reach us through the following channels:",
                emailSupport: "Email Support:",
                phoneSupport: "Phone Support:",
                whatsappSupport: "WhatsApp Support:",
                inPersonSupport: "In-Person Support:",
                
                // Toast Messages
                welcome: "Welcome to Saral Sahayata!",
                loginSuccess: "Login successful!",
                signupSuccess: "Account created successfully!",
                logoutSuccess: "Logged out successfully!",
                profileUpdateSuccess: "Profile saved successfully!",
                feedbackSuccessToast: "Feedback submitted successfully!",
                languageChanged: "Language changed!",
                
                // Loading
                loading: "Loading...",
                
                // Logout Confirmation
                logoutConfirmTitle: "Logout Confirmation",
                logoutConfirmMessage: "Are you sure you want to logout?",
                cancel: "Cancel",
                confirmLogout: "Yes, Logout"
            }
        };

        // Current language - Default Hindi
        let currentLanguage = 'hi';

        // Fixed Firebase Configuration
        let database, auth, linksRef, adsRef, settingsRef, usersRef, feedbackRef, contentRef, analyticsRef;

        try {
            const firebaseConfig = {
                apiKey: "AIzaSyDjYYketRe_mLhPefzG1-gbcV4kxOFxJ4s",
                authDomain: "saral-sahayata.firebaseapp.com",
                databaseURL: "https://saral-sahayata-default-rtdb.asia-southeast1.firebasedatabase.app",
                projectId: "saral-sahayata",
                storageBucket: "saral-sahayata.appspot.com",
                messagingSenderId: "2040973139",
                appId: "1:2040973139:web:d2f0c7c5ee2fddf89583a6"
            };
            
            // Check if Firebase app is already initialized
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            
            // Initialize Firebase services
            database = firebase.database();
            auth = firebase.auth();
            linksRef = database.ref('links');
            adsRef = database.ref('ads');
            settingsRef = database.ref('settings');
            usersRef = database.ref('users');
            feedbackRef = database.ref('feedback');
            contentRef = database.ref('content');
            analyticsRef = database.ref('analytics');
            
        } catch (error) {
            console.error("Firebase initialization failed:", error);
            // Fallback to prevent crashes
            database = { ref: () => ({ on: () => {}, off: () => {}, push: () => Promise.resolve() }) };
            auth = {
                onAuthStateChanged: () => {},
                signOut: () => Promise.resolve(),
                signInWithEmailAndPassword: () => Promise.reject(new Error('Firebase not initialized')),
                createUserWithEmailAndPassword: () => Promise.reject(new Error('Firebase not initialized'))
            };
        }

        // Enhanced Categories with Hindi Support
        let categories = translations[currentLanguage].categories;
        
        let currentCategory = 'all';
        let adFrequency = 3;
        let currentUser = null;
        let userData = null;
        let allLinks = {};
        let allAds = {};
        let filteredLinks = [];
        let searchTimeout;

        // Safe DOM Element Access
        function getElementSafe(id) {
            const element = document.getElementById(id);
            if (!element) {
                console.warn(`Element with id '${id}' not found`);
            }
            return element;
        }

        // DOM Elements
        const elements = {
            linkGrid: getElementSafe('link-grid'),
            categoryMenu: getElementSafe('category-menu'),
            searchInput: getElementSafe('search-input'),
            searchContainer: getElementSafe('search-container'),
            toast: getElementSafe('toast-notification'),
            toastText: getElementSafe('toast-text'),
            toastIcon: getElementSafe('toast-icon'),
            loadingSpinner: getElementSafe('loading-spinner'),
            authBtn: getElementSafe('auth-btn'),
            authBtnText: getElementSafe('auth-btn-text'),
            profileSection: getElementSafe('profile-section'),
            profileBtn: getElementSafe('profile-btn'),
            profileDropdown: getElementSafe('profile-dropdown'),
            userName: getElementSafe('user-name'),
            userEmail: getElementSafe('user-email'),
            userBio: getElementSafe('user-bio'),
            authModal: getElementSafe('auth-modal'),
            closeAuth: getElementSafe('close-auth'),
            loginForm: getElementSafe('login-form'),
            signupForm: getElementSafe('signup-form'),
            switchToSignup: getElementSafe('switch-to-signup'),
            switchToLogin: getElementSafe('switch-to-login'),
            editProfileBtn: getElementSafe('edit-profile-btn'),
            privacyPolicyBtn: getElementSafe('privacy-policy-btn'),
            termsServiceBtn: getElementSafe('terms-service-btn'),
            aboutBtn: getElementSafe('about-btn'),
            feedbackSupportBtn: getElementSafe('feedback-support-btn'),
            whatsappChannelBtn: getElementSafe('whatsapp-channel-btn'),
            logoutBtn: getElementSafe('logout-btn'),
            editProfileModal: getElementSafe('edit-profile-modal'),
            closeEditProfile: getElementSafe('close-edit-profile'),
            backEditProfile: getElementSafe('back-edit-profile'),
            editProfileForm: getElementSafe('edit-profile-form'),
            profilePicture: getElementSafe('profile-picture'),
            profileInitials: getElementSafe('profile-initials'),
            changePhotoBtn: getElementSafe('change-photo-btn'),
            editBio: getElementSafe('edit-bio'),
            bioCounter: getElementSafe('bio-counter'),
            editGender: getElementSafe('edit-gender'),
            homeScreen: getElementSafe('home-screen'),
            privacyPolicyPage: getElementSafe('privacy-policy-page'),
            termsServicePage: getElementSafe('terms-service-page'),
            aboutPage: getElementSafe('about-page'),
            feedbackSupportPage: getElementSafe('feedback-support-page'),
            backPrivacyPolicy: getElementSafe('back-privacy-policy'),
            backTermsService: getElementSafe('back-terms-service'),
            backAbout: getElementSafe('back-about'),
            backFeedbackSupport: getElementSafe('back-feedback-support'),
            feedbackForm: getElementSafe('feedback-form'),
            feedbackSuccess: getElementSafe('feedback-success'),
            logoutConfirmationModal: getElementSafe('logout-confirmation-modal'),
            logoutCancelBtn: getElementSafe('logout-cancel'),
            logoutConfirmBtn: getElementSafe('logout-confirm'),
            signupPhone: getElementSafe('signup-phone'),
            signupPhoneError: getElementSafe('signup-phone-error'),
            editPhone: getElementSafe('edit-phone'),
            editPhoneError: getElementSafe('edit-phone-error'),
            signupPassword: getElementSafe('signup-password'),
            signupPasswordError: getElementSafe('signup-password-error'),
            loginPassword: getElementSafe('login-password'),
            loginPasswordError: getElementSafe('login-password-error'),
            languageSection: getElementSafe('language-section'),
            languageBtn: getElementSafe('language-btn'),
            languageDropdown: getElementSafe('language-dropdown'),
            languageOptions: document.querySelectorAll('.language-option')
        };

        // Safe Event Listener
        function addSafeEventListener(element, event, handler) {
            if (element && typeof handler === 'function') {
                element.addEventListener(event, handler);
                return true;
            }
            return false;
        }

        // Global Image Error Handler
        window.handleImageError = function(imgElement, fallbackText) {
            if (!imgElement) return;
            
            try {
                imgElement.style.display = 'none';
                const parent = imgElement.parentElement;
                
                // Find or create fallback element
                let fallback = imgElement.nextElementSibling;
                if (!fallback || !fallback.classList.contains('fallback-text')) {
                    fallback = document.createElement('span');
                    fallback.className = 'fallback-text';
                    fallback.style.display = 'flex';
                    fallback.style.alignItems = 'center';
                    fallback.style.justifyContent = 'center';
                    fallback.style.fontWeight = '600';
                    fallback.style.color = 'white';
                    fallback.style.background = 'var(--primary-color)';
                    fallback.textContent = fallbackText || 'G';
                    imgElement.parentNode.insertBefore(fallback, imgElement.nextSibling);
                } else {
                    fallback.style.display = 'flex';
                    if (fallbackText) {
                        fallback.textContent = fallbackText;
                    }
                }
            } catch (error) {
                console.error('Image error handling failed:', error);
            }
        };

        // Language Management Functions
        function setLanguage(lang) {
            if (!translations[lang]) {
                console.error('Invalid language:', lang);
                return;
            }
            
            currentLanguage = lang;
            categories = translations[lang].categories;
            
            // UI update करें
            updateUIWithLanguage();
            
            // Language dropdown update करें
            updateLanguageDropdown();
            
            // Preference save करें
            localStorage.setItem('saralSahayataLanguage', lang);
            
            // Toast notification
            showToast(translations[lang].languageChanged, 'success');
            
            // Links को फिर से filter करें
            filterLinks(currentCategory, elements.searchInput ? elements.searchInput.value : '');
        }

        function updateLanguageDropdown() {
            if (!elements.languageOptions.length) return;
            
            elements.languageOptions.forEach(option => {
                option.classList.remove('active');
                const icon = option.querySelector('i');
                if (icon) {
                    icon.style.visibility = 'hidden';
                }
                
                if (option.dataset.lang === currentLanguage) {
                    option.classList.add('active');
                    const activeIcon = option.querySelector('i');
                    if (activeIcon) {
                        activeIcon.style.visibility = 'visible';
                    }
                }
            });
        }

        function updateUIWithLanguage() {
            const t = translations[currentLanguage];
            if (!t) return;
            
            // Header update
            if (elements.authBtnText) elements.authBtnText.textContent = t.authButton;
            
            // App name और tagline update
            const appNameElement = document.querySelector('.app-name');
            const appTaglineElement = document.querySelector('.app-tagline');
            if (appNameElement) appNameElement.textContent = t.appName;
            if (appTaglineElement) appTaglineElement.textContent = t.appTagline;
            
            // Search placeholder
            if (elements.searchInput) elements.searchInput.placeholder = t.searchPlaceholder;
            
            // Categories को फिर से render करें
            renderCategories();
            
            // Auth modal content
            updateAuthModalContent(t);
            
            // Profile dropdown content
            updateProfileDropdownContent(t);
            
            // Edit profile modal content
            updateEditProfileModalContent(t);
            
            // Content pages titles
            updateContentPagesTitles(t);
            
            // Feedback form content
            updateFeedbackFormContent(t);
            
            // Back buttons text
            updateBackButtonsContent(t);
            
            // Loading text
            const spinnerText = document.querySelector('.spinner-text');
            if (spinnerText) spinnerText.textContent = t.loading;
        }

        // Helper functions for UI updates
        function updateAuthModalContent(t) {
            const authTabs = document.querySelectorAll('.auth-tab');
            if (authTabs.length >= 2) {
                authTabs[0].textContent = t.loginTab;
                authTabs[1].textContent = t.signupTab;
            }
            
            // Login form
            const loginEmailLabel = document.querySelector('label[for="login-email"]');
            const loginPasswordLabel = document.querySelector('label[for="login-password"]');
            const loginEmailInput = document.getElementById('login-email');
            const loginPasswordInput = document.getElementById('login-password');
            const loginSubmit = document.querySelector('#login-form .auth-submit');
            const loginSwitch = document.querySelector('#login-form .auth-switch');
            
            if (loginEmailLabel) loginEmailLabel.textContent = t.loginEmail;
            if (loginPasswordLabel) loginPasswordLabel.textContent = t.loginPassword;
            if (loginEmailInput) loginEmailInput.placeholder = t.loginEmailPlaceholder;
            if (loginPasswordInput) loginPasswordInput.placeholder = t.loginPasswordPlaceholder;
            if (loginSubmit) loginSubmit.textContent = t.loginSubmit;
            if (loginSwitch) loginSwitch.innerHTML = `${t.loginSwitch} <a id="switch-to-signup">${t.signupLink}</a>`;
            
            // Signup form
            const signupNameLabel = document.querySelector('label[for="signup-name"]');
            const signupEmailLabel = document.querySelector('label[for="signup-email"]');
            const signupPasswordLabel = document.querySelector('label[for="signup-password"]');
            const signupPhoneLabel = document.querySelector('label[for="signup-phone"]');
            const signupNameInput = document.getElementById('signup-name');
            const signupEmailInput = document.getElementById('signup-email');
            const signupPasswordInput = document.getElementById('signup-password');
            const signupPhoneInput = document.getElementById('signup-phone');
            const signupSubmit = document.querySelector('#signup-form .auth-submit');
            const signupSwitch = document.querySelector('#signup-form .auth-switch');
            
            if (signupNameLabel) signupNameLabel.textContent = t.signupName;
            if (signupEmailLabel) signupEmailLabel.textContent = t.signupEmail;
            if (signupPasswordLabel) signupPasswordLabel.textContent = t.signupPassword;
            if (signupPhoneLabel) signupPhoneLabel.textContent = t.signupPhone;
            if (signupNameInput) signupNameInput.placeholder = t.signupNamePlaceholder;
            if (signupEmailInput) signupEmailInput.placeholder = t.signupEmailPlaceholder;
            if (signupPasswordInput) signupPasswordInput.placeholder = t.signupPasswordPlaceholder;
            if (signupPhoneInput) signupPhoneInput.placeholder = t.signupPhonePlaceholder;
            if (signupSubmit) signupSubmit.textContent = t.signupSubmit;
            if (signupSwitch) signupSwitch.innerHTML = `${t.signupSwitch} <a id="switch-to-login">${t.loginLink}</a>`;
        }

        function updateProfileDropdownContent(t) {
            if (elements.editProfileBtn) {
                elements.editProfileBtn.innerHTML = `<i class="fas fa-user-edit"></i><span>${t.editProfile}</span>`;
            }
            if (elements.privacyPolicyBtn) {
                elements.privacyPolicyBtn.innerHTML = `<i class="fas fa-shield-alt"></i><span>${t.privacyPolicy}</span>`;
            }
            if (elements.termsServiceBtn) {
                elements.termsServiceBtn.innerHTML = `<i class="fas fa-file-contract"></i><span>${t.termsService}</span>`;
            }
            if (elements.aboutBtn) {
                elements.aboutBtn.innerHTML = `<i class="fas fa-info-circle"></i><span>${t.about}</span>`;
            }
            if (elements.feedbackSupportBtn) {
                elements.feedbackSupportBtn.innerHTML = `<i class="fas fa-headset"></i><span>${t.feedbackSupport}</span>`;
            }
            if (elements.whatsappChannelBtn) {
                elements.whatsappChannelBtn.innerHTML = `<i class="fab fa-whatsapp"></i><span>${t.whatsappChannel}</span>`;
            }
            if (elements.logoutBtn) {
                elements.logoutBtn.innerHTML = `<i class="fas fa-sign-out-alt"></i><span>${t.logout}</span>`;
            }
        }

        function updateEditProfileModalContent(t) {
            const editProfileTitle = document.querySelector('.edit-profile-title');
            const changePhotoBtn = document.getElementById('change-photo-btn');
            const editNameLabel = document.querySelector('label[for="edit-name"]');
            const editEmailLabel = document.querySelector('label[for="edit-email"]');
            const editPhoneLabel = document.querySelector('label[for="edit-phone"]');
            const editGenderLabel = document.querySelector('label[for="edit-gender"]');
            const editBioLabel = document.querySelector('label[for="edit-bio"]');
            const editNameInput = document.getElementById('edit-name');
            const editEmailInput = document.getElementById('edit-email');
            const editPhoneInput = document.getElementById('edit-phone');
            const editBioInput = document.getElementById('edit-bio');
            const editGenderSelect = document.getElementById('edit-gender');
            const editSubmit = document.querySelector('#edit-profile-form .auth-submit');
            const backButton = document.getElementById('back-edit-profile');
            
            if (editProfileTitle) editProfileTitle.textContent = t.editProfileTitle;
            if (changePhotoBtn) changePhotoBtn.textContent = t.changePhoto;
            if (editNameLabel) editNameLabel.textContent = t.fullName;
            if (editEmailLabel) editEmailLabel.textContent = t.email;
            if (editPhoneLabel) editPhoneLabel.textContent = t.phone;
            if (editGenderLabel) editGenderLabel.textContent = t.gender;
            if (editBioLabel) editBioLabel.textContent = t.bio;
            if (editNameInput) editNameInput.placeholder = t.fullNamePlaceholder;
            if (editEmailInput) editEmailInput.placeholder = t.emailPlaceholder;
            if (editPhoneInput) editPhoneInput.placeholder = t.phonePlaceholder;
            if (editBioInput) editBioInput.placeholder = t.bioPlaceholder;
            if (editSubmit) editSubmit.textContent = t.saveChanges;
            if (backButton) backButton.innerHTML = `<i class="fas fa-arrow-left"></i><span>${t.back}</span>`;
            
            // Update gender options
            if (editGenderSelect) {
                const options = editGenderSelect.querySelectorAll('option');
                if (options.length >= 5) {
                    options[0].textContent = t.selectGender;
                    options[1].textContent = t.male;
                    options[2].textContent = t.female;
                    options[3].textContent = t.other;
                    options[4].textContent = t.preferNotToSay;
                }
            }
        }

        function updateContentPagesTitles(t) {
            const privacyPolicyTitle = document.querySelector('#privacy-policy-page .content-title');
            const termsServiceTitle = document.querySelector('#terms-service-page .content-title');
            const aboutTitle = document.querySelector('#about-page .content-title');
            const feedbackSupportTitle = document.querySelector('#feedback-support-page .content-title');
            
            if (privacyPolicyTitle) privacyPolicyTitle.textContent = t.privacyPolicyTitle;
            if (termsServiceTitle) termsServiceTitle.textContent = t.termsServiceTitle;
            if (aboutTitle) aboutTitle.textContent = t.aboutTitle;
            if (feedbackSupportTitle) feedbackSupportTitle.textContent = t.feedbackSupportTitle;
        }

        function updateFeedbackFormContent(t) {
            const feedbackTitle = document.querySelector('#feedback-support-page .content-section h2');
            const feedbackDescription = document.querySelector('#feedback-support-page .content-section p');
            const feedbackNameLabel = document.querySelector('label[for="feedback-name"]');
            const feedbackEmailLabel = document.querySelector('label[for="feedback-email"]');
            const feedbackPhoneLabel = document.querySelector('label[for="feedback-phone"]');
            const feedbackTypeLabel = document.querySelector('label[for="feedback-type"]');
            const feedbackSubjectLabel = document.querySelector('label[for="feedback-subject"]');
            const feedbackMessageLabel = document.querySelector('label[for="feedback-message"]');
            const feedbackSubmit = document.querySelector('#feedback-form .feedback-submit');
            const feedbackSuccessTitle = document.querySelector('#feedback-success h3');
            const feedbackSuccessMessage = document.querySelector('#feedback-success p');
            const supportChannelsTitle = document.querySelector('#feedback-support-page .content-section:last-child h2');
            const supportDescription = document.querySelector('#feedback-support-page .content-section:last-child p');
            
            if (feedbackTitle) feedbackTitle.textContent = t.feedbackTitle;
            if (feedbackDescription) feedbackDescription.textContent = t.feedbackDescription;
            if (feedbackNameLabel) feedbackNameLabel.textContent = t.fullNameLabel;
            if (feedbackEmailLabel) feedbackEmailLabel.textContent = t.emailLabel;
            if (feedbackPhoneLabel) feedbackPhoneLabel.textContent = t.phoneLabel;
            if (feedbackTypeLabel) feedbackTypeLabel.textContent = t.feedbackType;
            if (feedbackSubjectLabel) feedbackSubjectLabel.textContent = t.subject;
            if (feedbackMessageLabel) feedbackMessageLabel.textContent = t.message;
            if (feedbackSubmit) feedbackSubmit.textContent = t.submit;
            if (feedbackSuccessTitle) feedbackSuccessTitle.textContent = t.feedbackSuccess;
            if (feedbackSuccessMessage) feedbackSuccessMessage.textContent = t.feedbackSuccessMessage;
            if (supportChannelsTitle) supportChannelsTitle.textContent = t.supportChannels;
            if (supportDescription) supportDescription.textContent = t.supportDescription;
            
            // Update feedback form placeholders and options
            const feedbackNameInput = document.getElementById('feedback-name');
            const feedbackEmailInput = document.getElementById('feedback-email');
            const feedbackPhoneInput = document.getElementById('feedback-phone');
            const feedbackTypeSelect = document.getElementById('feedback-type');
            const feedbackSubjectInput = document.getElementById('feedback-subject');
            const feedbackMessageTextarea = document.getElementById('feedback-message');
            
            if (feedbackNameInput) feedbackNameInput.placeholder = t.fullNamePlaceholderFeedback;
            if (feedbackEmailInput) feedbackEmailInput.placeholder = t.emailPlaceholderFeedback;
            if (feedbackPhoneInput) feedbackPhoneInput.placeholder = t.phonePlaceholderFeedback;
            if (feedbackSubjectInput) feedbackSubjectInput.placeholder = t.subjectPlaceholder;
            if (feedbackMessageTextarea) feedbackMessageTextarea.placeholder = t.messagePlaceholder;
            
            // Update feedback type options
            if (feedbackTypeSelect) {
                const options = feedbackTypeSelect.querySelectorAll('option');
                if (options.length >= 6) {
                    options[0].textContent = t.selectFeedbackType;
                    options[1].textContent = t.suggestion;
                    options[2].textContent = t.bug;
                    options[3].textContent = t.complaint;
                    options[4].textContent = t.compliment;
                    options[5].textContent = t.general;
                }
            }
        }

        function updateBackButtonsContent(t) {
            const backButtons = document.querySelectorAll('.back-button span');
            backButtons.forEach(button => {
                button.textContent = t.back;
            });
        }

        // Show loading spinner
        function showLoading() {
            if (elements.loadingSpinner) {
                elements.loadingSpinner.classList.add('show');
            }
        }

        // Hide loading spinner
        function hideLoading() {
            if (elements.loadingSpinner) {
                elements.loadingSpinner.classList.remove('show');
            }
        }

        // Enhanced Firebase Error Handler with Hindi Messages
        function handleFirebaseError(error) {
            console.error('Firebase Error:', error);
            
            const errorMessages = {
                'auth/email-already-in-use': 'यह ईमेल पहले से रजिस्टर्ड है',
                'auth/invalid-email': 'अमान्य ईमेल पता',
                'auth/weak-password': 'पासवर्ड कम से कम 6 अक्षर का होना चाहिए',
                'auth/user-not-found': 'इस ईमेल से कोई खाता नहीं मिला',
                'auth/wrong-password': 'गलत पासवर्ड',
                'auth/network-request-failed': 'नेटवर्क त्रुटि। कृपया इंटरनेट कनेक्शन जांचें',
                'auth/too-many-requests': 'बहुत सारे प्रयास। कृपया बाद में पुनः प्रयास करें',
                'auth/operation-not-allowed': 'यह ऑपरेशन अनुमति नहीं है',
                'auth/user-disabled': 'यह उपयोगकर्ता अक्षम कर दिया गया है',
                'PERMISSION_DENIED': 'डेटा एक्सेस की अनुमति नहीं है'
            };
            
            return errorMessages[error.code] || 'एक त्रुटि हुई। कृपया पुनः प्रयास करें';
        }

        // Enhanced Input sanitization for security
        function sanitizeInput(input) {
            if (input === null || input === undefined) return '';
            
            const str = String(input).trim();
            
            // Basic XSS prevention
            return str
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#x27;')
                .replace(/\//g, '&#x2F;');
        }

        function sanitizeURL(url) {
            if (!url) return '#';
            
            try {
                // Allow relative URLs and data URIs for local development
                if (url.startsWith('/') || url.startsWith('./') || url.startsWith('../') || url.startsWith('data:')) {
                    return url;
                }
                
                const parsed = new URL(url);
                // Only allow HTTPS URLs for external links
                if (parsed.protocol !== 'https:') {
                    console.warn('Non-HTTPS URL blocked:', url);
                    return '#';
                }
                return parsed.toString();
            } catch {
                console.warn('Invalid URL:', url);
                return '#';
            }
        }

        // Check online status
        function checkOnlineStatus() {
            if (!navigator.onLine) {
                showToast('आप ऑफलाइन हैं। कुछ सुविधाएं काम नहीं कर सकती हैं।', 'warning');
            }
        }

        // Search Container Management
        function showSearchBar() {
            if (elements.searchContainer) {
                elements.searchContainer.style.display = 'block';
                setTimeout(() => {
                    elements.searchContainer.classList.add('show');
                }, 10);
            }
        }

        function hideSearchBar() {
            if (elements.searchContainer) {
                elements.searchContainer.classList.remove('show');
                setTimeout(() => {
                    elements.searchContainer.style.display = 'none';
                }, 300);
            }
        }

        // Authentication State Listener
        if (auth && auth.onAuthStateChanged) {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    // User is signed in
                    currentUser = user;
                    loadUserData(user);
                    showProfileSection(user);
                    showToast(translations[currentLanguage].loginSuccess, 'success');
                } else {
                    // User is signed out
                    currentUser = null;
                    userData = null;
                    showAuthButton();
                }
            });
        }

        // Load user data from database
        function loadUserData(user) {
            if (!user || !user.uid || !usersRef) return;
            
            usersRef.child(user.uid).on('value', (snapshot) => {
                userData = snapshot.val() || {};
                updateProfileDisplay();
            }, (error) => {
                console.error('Error loading user data:', error);
            });
        }

        function updateProfileDisplay() {
            if (currentUser && userData) {
                // Get user's first letter for profile picture
                const name = currentUser.displayName || userData.name || 'उपयोगकर्ता';
                const firstLetter = getFirstLetter(name);
                
                // Update header profile button with first letter
                if (elements.profileBtn) {
                    elements.profileBtn.innerHTML = firstLetter;
                }
                
                // Update profile picture in modal with first letter
                if (elements.profileInitials) {
                    elements.profileInitials.textContent = firstLetter;
                }
                
                // Update header dropdown
                if (elements.userName) elements.userName.textContent = name;
                if (elements.userEmail) elements.userEmail.textContent = currentUser.email || 'ईमेल उपलब्ध नहीं';
                
                // Update bio in dropdown
                if (elements.userBio) {
                    if (userData.bio) {
                        elements.userBio.textContent = userData.bio;
                        elements.userBio.style.display = 'block';
                    } else {
                        elements.userBio.style.display = 'none';
                    }
                }
                
                // Update edit profile form
                if (elements.editProfileForm) {
                    const editName = document.getElementById('edit-name');
                    const editEmail = document.getElementById('edit-email');
                    const editPhone = document.getElementById('edit-phone');
                    const editGender = document.getElementById('edit-gender');
                    const editBio = document.getElementById('edit-bio');
                    
                    if (editName) editName.value = name;
                    if (editEmail) editEmail.value = currentUser.email || '';
                    if (editPhone) editPhone.value = userData.phone || '';
                    if (editGender) editGender.value = userData.gender || '';
                    if (editBio) editBio.value = userData.bio || '';
                    if (elements.bioCounter) elements.bioCounter.textContent = (userData.bio || '').length;
                }
            }
        }

        function getFirstLetter(name) {
            if (!name || typeof name !== 'string') return 'U';
            return name.trim().charAt(0).toUpperCase();
        }

        function showProfileSection(user) {
            if (!elements.authBtn || !elements.profileSection) return;
            elements.authBtn.style.display = 'none';
            elements.profileSection.style.display = 'block';
            updateProfileDisplay();
        }

        function showAuthButton() {
            if (!elements.authBtn || !elements.profileSection) return;
            elements.authBtn.style.display = 'flex';
            elements.profileSection.style.display = 'none';
            if (elements.profileBtn) elements.profileBtn.innerHTML = '<i class="fas fa-user"></i>';
        }

        // Page Navigation Functions
        function showHomePage() {
            hideAllPages();
            if (elements.homeScreen) {
                elements.homeScreen.style.display = 'block';
                showSearchBar(); // Show search only on home page
            }
        }

        function showPrivacyPolicyPage() {
            hideAllPages();
            if (elements.privacyPolicyPage) {
                elements.privacyPolicyPage.classList.add('active');
                hideSearchBar(); // Hide search on other pages
            }
        }

        function showTermsServicePage() {
            hideAllPages();
            if (elements.termsServicePage) {
                elements.termsServicePage.classList.add('active');
                hideSearchBar(); // Hide search on other pages
            }
        }

        function showAboutPage() {
            hideAllPages();
            if (elements.aboutPage) {
                elements.aboutPage.classList.add('active');
                hideSearchBar(); // Hide search on other pages
            }
        }

        function showFeedbackSupportPage() {
            hideAllPages();
            if (elements.feedbackSupportPage) {
                elements.feedbackSupportPage.classList.add('active');
                hideSearchBar(); // Hide search on other pages
            }
        }

        function hideAllPages() {
            if (elements.homeScreen) elements.homeScreen.style.display = 'none';
            if (elements.privacyPolicyPage) elements.privacyPolicyPage.classList.remove('active');
            if (elements.termsServicePage) elements.termsServicePage.classList.remove('active');
            if (elements.aboutPage) elements.aboutPage.classList.remove('active');
            if (elements.feedbackSupportPage) elements.feedbackSupportPage.classList.remove('active');
        }

        // Modal Management Functions
        function openAuthModal() {
            if (!elements.authModal) return;
            elements.authModal.classList.add('active');
            document.body.classList.add('modal-open');
        }

        function closeAuthModal() {
            if (!elements.authModal) return;
            elements.authModal.classList.remove('active');
            document.body.classList.remove('modal-open');
            if (elements.loginForm) elements.loginForm.reset();
            if (elements.signupForm) elements.signupForm.reset();
            clearValidationErrors();
        }

        function openEditProfileModal() {
            if (!elements.editProfileModal) return;
            elements.editProfileModal.classList.add('active');
            document.body.classList.add('modal-open');
            if (elements.profileDropdown) elements.profileDropdown.classList.remove('show');
        }

        function closeEditProfileModal() {
            if (!elements.editProfileModal) return;
            elements.editProfileModal.classList.remove('active');
            document.body.classList.remove('modal-open');
            clearValidationErrors();
        }

        function openLogoutConfirmation() {
            if (!elements.logoutConfirmationModal) return;
            elements.logoutConfirmationModal.classList.add('active');
            document.body.classList.add('modal-open');
            if (elements.profileDropdown) elements.profileDropdown.classList.remove('show');
        }

        function closeLogoutConfirmation() {
            if (!elements.logoutConfirmationModal) return;
            elements.logoutConfirmationModal.classList.remove('active');
            document.body.classList.remove('modal-open');
        }

        function switchAuthTab(tabName) {
            const authTabs = document.querySelectorAll('.auth-tab');
            if (!authTabs.length) return;
            
            authTabs.forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.tab === tabName) {
                    tab.classList.add('active');
                }
            });
            
            if (elements.loginForm) elements.loginForm.classList.remove('active');
            if (elements.signupForm) elements.signupForm.classList.remove('active');
            
            const targetForm = document.getElementById(`${tabName}-form`);
            if (targetForm) targetForm.classList.add('active');
            
            clearValidationErrors();
        }

        // Input Validation Functions
        function validatePhoneNumber(phone) {
            if (!phone) return true; // Optional field
            const phoneRegex = /^[6789]\d{9}$/;
            return phoneRegex.test(phone.replace(/\D/g, ''));
        }

        function validatePassword(password) {
            return password && password.length >= 6;
        }

        function showError(inputElement, errorElement, message) {
            if (!inputElement || !errorElement) return;
            inputElement.classList.add('input-error');
            errorElement.textContent = message;
            errorElement.classList.add('show');
        }

        function hideError(inputElement, errorElement) {
            if (!inputElement || !errorElement) return;
            inputElement.classList.remove('input-error');
            errorElement.classList.remove('show');
        }

        function clearValidationErrors() {
            // Clear all validation errors
            document.querySelectorAll('.input-error').forEach(el => {
                el.classList.remove('input-error');
            });
            document.querySelectorAll('.error-message').forEach(el => {
                el.classList.remove('show');
            });
        }

        // Event Listeners for Input Validation
        addSafeEventListener(elements.signupPhone, 'input', (e) => {
            const phone = e.target.value.replace(/\D/g, '');
            e.target.value = phone; // Remove non-digit characters
            if (phone && !validatePhoneNumber(phone)) {
                showError(elements.signupPhone, elements.signupPhoneError, 'कृपया वैध 10-अंकीय फोन नंबर दर्ज करें');
            } else {
                hideError(elements.signupPhone, elements.signupPhoneError);
            }
        });

        addSafeEventListener(elements.editPhone, 'input', (e) => {
            const phone = e.target.value.replace(/\D/g, '');
            e.target.value = phone; // Remove non-digit characters
            if (phone && !validatePhoneNumber(phone)) {
                showError(elements.editPhone, elements.editPhoneError, 'कृपया वैध 10-अंकीय फोन नंबर दर्ज करें');
            } else {
                hideError(elements.editPhone, elements.editPhoneError);
            }
        });

        addSafeEventListener(elements.signupPassword, 'input', (e) => {
            const password = e.target.value;
            if (password && !validatePassword(password)) {
                showError(elements.signupPassword, elements.signupPasswordError, 'पासवर्ड कम से कम 6 वर्ण का होना चाहिए');
            } else {
                hideError(elements.signupPassword, elements.signupPasswordError);
            }
        });

        addSafeEventListener(elements.loginPassword, 'input', (e) => {
            const password = e.target.value;
            if (password && !validatePassword(password)) {
                showError(elements.loginPassword, elements.loginPasswordError, 'पासवर्ड कम से कम 6 वर्ण का होना चाहिए');
            } else {
                hideError(elements.loginPassword, elements.loginPasswordError);
            }
        });

        // Event Listeners
        addSafeEventListener(elements.authBtn, 'click', () => {
            openAuthModal();
            switchAuthTab('login');
        });

        addSafeEventListener(elements.closeAuth, 'click', closeAuthModal);

        addSafeEventListener(elements.authModal, 'click', (e) => {
            if (e.target === elements.authModal) {
                closeAuthModal();
            }
        });

        addSafeEventListener(elements.editProfileModal, 'click', (e) => {
            if (e.target === elements.editProfileModal) {
                closeEditProfileModal();
            }
        });

        addSafeEventListener(elements.logoutConfirmationModal, 'click', (e) => {
            if (e.target === elements.logoutConfirmationModal) {
                closeLogoutConfirmation();
            }
        });

        // Auth tabs
        document.querySelectorAll('.auth-tab').forEach(tab => {
            addSafeEventListener(tab, 'click', () => {
                switchAuthTab(tab.dataset.tab);
            });
        });

        // Language dropdown functionality
        addSafeEventListener(elements.languageBtn, 'click', (e) => {
            e.stopPropagation();
            if (elements.languageDropdown) {
                elements.languageDropdown.classList.toggle('show');
            }
        });

        // Language option selection
        elements.languageOptions.forEach(option => {
            addSafeEventListener(option, 'click', (e) => {
                e.preventDefault();
                const lang = option.dataset.lang;
                setLanguage(lang);
                
                // Close dropdown
                if (elements.languageDropdown) {
                    elements.languageDropdown.classList.remove('show');
                }
            });
        });

        // Close language dropdown when clicking outside
        document.addEventListener('click', () => {
            if (elements.languageDropdown) {
                elements.languageDropdown.classList.remove('show');
            }
            if (elements.profileDropdown) {
                elements.profileDropdown.classList.remove('show');
            }
        });

        // Prevent dropdown close when clicking inside
        if (elements.languageDropdown) {
            addSafeEventListener(elements.languageDropdown, 'click', (e) => {
                e.stopPropagation();
            });
        }

        if (elements.profileDropdown) {
            addSafeEventListener(elements.profileDropdown, 'click', (e) => {
                e.stopPropagation();
            });
        }

        // Re-attach switch auth event listeners after language change
        function reattachAuthSwitchListeners() {
            const switchToSignup = document.getElementById('switch-to-signup');
            const switchToLogin = document.getElementById('switch-to-login');
            
            if (switchToSignup) {
                switchToSignup.addEventListener('click', (e) => {
                    e.preventDefault();
                    switchAuthTab('signup');
                });
            }
            
            if (switchToLogin) {
                switchToLogin.addEventListener('click', (e) => {
                    e.preventDefault();
                    switchAuthTab('login');
                });
            }
        }

        addSafeEventListener(elements.switchToSignup, 'click', (e) => {
            e.preventDefault();
            switchAuthTab('signup');
        });

        addSafeEventListener(elements.switchToLogin, 'click', (e) => {
            e.preventDefault();
            switchAuthTab('login');
        });

        // Dropdown Button Events
        addSafeEventListener(elements.editProfileBtn, 'click', () => {
            openEditProfileModal();
            if (elements.profileDropdown) elements.profileDropdown.classList.remove('show');
        });

        addSafeEventListener(elements.privacyPolicyBtn, 'click', () => {
            showPrivacyPolicyPage();
            if (elements.profileDropdown) elements.profileDropdown.classList.remove('show');
        });

        addSafeEventListener(elements.termsServiceBtn, 'click', () => {
            showTermsServicePage();
            if (elements.profileDropdown) elements.profileDropdown.classList.remove('show');
        });

        addSafeEventListener(elements.aboutBtn, 'click', () => {
            showAboutPage();
            if (elements.profileDropdown) elements.profileDropdown.classList.remove('show');
        });

        addSafeEventListener(elements.feedbackSupportBtn, 'click', () => {
            showFeedbackSupportPage();
            if (elements.profileDropdown) elements.profileDropdown.classList.remove('show');
        });

        addSafeEventListener(elements.whatsappChannelBtn, 'click', () => {
            window.open('https://whatsapp.com/channel/0029VaExample', '_blank');
            showToast('व्हाट्सएप चैनल से जुड़ गए!', 'success');
            if (elements.profileDropdown) elements.profileDropdown.classList.remove('show');
        });

        // Logout functionality with confirmation
        addSafeEventListener(elements.logoutBtn, 'click', () => {
            openLogoutConfirmation();
        });

        addSafeEventListener(elements.logoutCancelBtn, 'click', () => {
            closeLogoutConfirmation();
        });

        addSafeEventListener(elements.logoutConfirmBtn, 'click', () => {
            if (auth && auth.signOut) {
                auth.signOut()
                    .then(() => {
                        closeLogoutConfirmation();
                        showToast(translations[currentLanguage].logoutSuccess, 'success');
                    })
                    .catch((error) => {
                        closeLogoutConfirmation();
                        showToast('लॉगआउट विफल!', 'error');
                    });
            }
        });

        // Back button for edit profile
        addSafeEventListener(elements.backEditProfile, 'click', () => {
            closeEditProfileModal();
        });

        // Back buttons for content pages
        addSafeEventListener(elements.backPrivacyPolicy, 'click', () => {
            showHomePage();
        });

        addSafeEventListener(elements.backTermsService, 'click', () => {
            showHomePage();
        });

        addSafeEventListener(elements.backAbout, 'click', () => {
            showHomePage();
        });

        addSafeEventListener(elements.backFeedbackSupport, 'click', () => {
            showHomePage();
        });

        addSafeEventListener(elements.changePhotoBtn, 'click', (e) => {
            e.preventDefault();
            showToast('फोटो बदलने की सुविधा जल्द ही आ रही है!', 'info');
        });

        // Bio character counter
        addSafeEventListener(elements.editBio, 'input', (e) => {
            const length = e.target.value.length;
            if (elements.bioCounter) elements.bioCounter.textContent = length;
            
            if (length > 140) {
                elements.bioCounter.style.color = 'var(--danger-color)';
            } else if (length > 120) {
                elements.bioCounter.style.color = 'var(--warning-color)';
            } else {
                elements.bioCounter.style.color = 'var(--light-text-color)';
            }
        });

        // Edit Profile Form Submission
        addSafeEventListener(elements.editProfileForm, 'submit', (e) => {
            e.preventDefault();
            
            if (!currentUser) {
                showToast('कृपया पहले लॉग इन करें', 'error');
                return;
            }
            
            const name = sanitizeInput(document.getElementById('edit-name').value);
            const phone = document.getElementById('edit-phone').value;
            const gender = document.getElementById('edit-gender').value;
            const bio = sanitizeInput(document.getElementById('edit-bio').value);
            
            // Validate phone number
            if (phone && !validatePhoneNumber(phone)) {
                showError(elements.editPhone, elements.editPhoneError, 'कृपया वैध 10-अंकीय फोन नंबर दर्ज करें');
                return;
            }
            
            showLoading();
            
            // Update user profile in Firebase Auth
            if (currentUser.updateProfile) {
                currentUser.updateProfile({
                    displayName: name
                }).then(() => {
                    // Update user data in database
                    return usersRef.child(currentUser.uid).update({
                        name: name,
                        phone: phone,
                        gender: gender,
                        bio: bio,
                        updatedAt: Date.now()
                    });
                }).then(() => {
                    closeEditProfileModal();
                    showToast(translations[currentLanguage].profileUpdateSuccess, 'success');
                    updateProfileDisplay();
                    hideLoading();
                }).catch((error) => {
                    hideLoading();
                    const errorMessage = handleFirebaseError(error);
                    showToast('प्रोफाइल सहेजने में विफल: ' + errorMessage, 'error');
                });
            }
        });

        // Login Form Submission
        addSafeEventListener(elements.loginForm, 'submit', (e) => {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            // Validate password
            if (!validatePassword(password)) {
                showError(elements.loginPassword, elements.loginPasswordError, 'पासवर्ड कम से कम 6 वर्ण का होना चाहिए');
                return;
            }
            
            showLoading();
            
            if (auth && auth.signInWithEmailAndPassword) {
                auth.signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        closeAuthModal();
                        showToast(translations[currentLanguage].loginSuccess, 'success');
                        hideLoading();
                    })
                    .catch((error) => {
                        const errorMessage = handleFirebaseError(error);
                        showToast(errorMessage, 'error');
                        hideLoading();
                    });
            }
        });

        // Signup Form Submission
        addSafeEventListener(elements.signupForm, 'submit', (e) => {
            e.preventDefault();
            
            const name = sanitizeInput(document.getElementById('signup-name').value);
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const phone = document.getElementById('signup-phone').value;
            
            // Validate password
            if (!validatePassword(password)) {
                showError(elements.signupPassword, elements.signupPasswordError, 'पासवर्ड कम से कम 6 वर्ण का होना चाहिए');
                return;
            }
            
            // Validate phone number if provided
            if (phone && !validatePhoneNumber(phone)) {
                showError(elements.signupPhone, elements.signupPhoneError, 'कृपया वैध 10-अंकीय फोन नंबर दर्ज करें');
                return;
            }
            
            showLoading();
            
            if (auth && auth.createUserWithEmailAndPassword) {
                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        return userCredential.user.updateProfile({
                            displayName: name
                        }).then(() => {
                            return usersRef.child(userCredential.user.uid).set({
                                name: name,
                                email: email,
                                phone: phone,
                                createdAt: Date.now(),
                                lastLogin: Date.now()
                            });
                        });
                    })
                    .then(() => {
                        closeAuthModal();
                        showToast(translations[currentLanguage].signupSuccess, 'success');
                        hideLoading();
                    })
                    .catch((error) => {
                        const errorMessage = handleFirebaseError(error);
                        showToast(errorMessage, 'error');
                        hideLoading();
                    });
            }
        });

        // Feedback Form Submission
        addSafeEventListener(elements.feedbackForm, 'submit', (e) => {
            e.preventDefault();
            
            const name = sanitizeInput(document.getElementById('feedback-name').value);
            const email = document.getElementById('feedback-email').value;
            const phone = document.getElementById('feedback-phone').value;
            const type = document.getElementById('feedback-type').value;
            const subject = sanitizeInput(document.getElementById('feedback-subject').value);
            const message = sanitizeInput(document.getElementById('feedback-message').value);
            
            // Validate phone number if provided
            if (phone && !validatePhoneNumber(phone)) {
                showToast('कृपया वैध 10-अंकीय फोन नंबर दर्ज करें', 'error');
                return;
            }
            
            showLoading();
            
            // Save feedback to Firebase
            const feedbackData = {
                name: name,
                email: email,
                phone: phone || '',
                type: type,
                subject: subject,
                message: message,
                timestamp: Date.now(),
                userId: currentUser ? currentUser.uid : 'anonymous'
            };
            
            if (feedbackRef && feedbackRef.push) {
                feedbackRef.push(feedbackData)
                    .then(() => {
                        hideLoading();
                        elements.feedbackForm.reset();
                        if (elements.feedbackSuccess) {
                            elements.feedbackSuccess.classList.add('show');
                            setTimeout(() => {
                                elements.feedbackSuccess.classList.remove('show');
                            }, 5000);
                        }
                        showToast(translations[currentLanguage].feedbackSuccessToast, 'success');
                    })
                    .catch((error) => {
                        hideLoading();
                        showToast('प्रतिक्रिया सबमिट करने में विफल!', 'error');
                    });
            }
        });

        // Profile Dropdown Toggle
        addSafeEventListener(elements.profileBtn, 'click', (e) => {
            e.stopPropagation();
            if (elements.profileDropdown) elements.profileDropdown.classList.toggle('show');
        });

        // Search Functionality with Debouncing
        addSafeEventListener(elements.searchInput, 'input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const searchTerm = (e.target.value || '').toLowerCase().trim();
                filterLinks(currentCategory, searchTerm);
            }, 300);
        });

        // Category Functions
        function renderCategories() {
            if (!elements.categoryMenu) return;
            elements.categoryMenu.innerHTML = '';
            
            Object.keys(categories).forEach(key => {
                const button = document.createElement('button');
                button.className = 'category-button';
                button.textContent = categories[key];
                button.dataset.category = key;
                if (key === currentCategory) {
                    button.classList.add('active-cat');
                }
                addSafeEventListener(button, 'click', () => {
                    filterLinks(key, elements.searchInput ? elements.searchInput.value : '');
                });
                elements.categoryMenu.appendChild(button);
            });
        }

        function filterLinks(category, searchTerm = '') {
            if (!category || typeof category !== 'string') {
                console.error('Invalid category:', category);
                return;
            }
            
            try {
                currentCategory = category;
                
                // Update active category button
                document.querySelectorAll('.category-button').forEach(btn => {
                    if (btn.dataset.category === category) {
                        btn.classList.add('active-cat');
                    } else {
                        btn.classList.remove('active-cat');
                    }
                });
                
                // Filter links based on category and search term
                filteredLinks = Object.keys(allLinks)
                    .map(key => {
                        const link = allLinks[key];
                        return link ? { ...link, key } : null;
                    })
                    .filter(link => {
                        if (!link) return false;
                        
                        const categoryMatch = currentCategory === 'all' || link.category === currentCategory;
                        const searchMatch = !searchTerm || 
                            (link.title && link.title.toLowerCase().includes(searchTerm)) ||
                            (link.description && link.description.toLowerCase().includes(searchTerm));
                        
                        return link.active !== false && categoryMatch && searchMatch;
                    })
                    .sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
                
                renderCards();
            } catch (error) {
                console.error('Error filtering links:', error);
                showToast('लिंक फ़िल्टर करने में त्रुटि', 'error');
            }
        }

        function fetchLinksAndAds() {
            showLoading();
            
            if (linksRef && linksRef.on) {
                linksRef.on('value', (snapshot) => {
                    allLinks = snapshot.val() || {};
                    filterLinks(currentCategory, elements.searchInput ? elements.searchInput.value : '');
                    hideLoading();
                }, (error) => {
                    showToast('लिंक लोड करने में विफल!', 'error');
                    hideLoading();
                });
            }

            if (adsRef && adsRef.on) {
                adsRef.on('value', (snapshot) => {
                    allAds = snapshot.val() || {};
                    renderCards();
                }, (error) => {
                    showToast('विज्ञापन लोड करने में विफल!', 'error');
                });
            }

            // Load content from Firebase
            if (contentRef && contentRef.on) {
                contentRef.on('value', (snapshot) => {
                    const content = snapshot.val() || {};
                    
                    // Update Privacy Policy
                    if (content.privacy) {
                        const privacyContent = document.getElementById('privacy-policy-content');
                        if (privacyContent) privacyContent.innerHTML = content.privacy;
                    }
                    
                    // Update Terms & Service
                    if (content.terms) {
                        const termsContent = document.getElementById('terms-service-content');
                        if (termsContent) termsContent.innerHTML = content.terms;
                    }
                    
                    // Update About
                    if (content.about) {
                        const aboutContent = document.getElementById('about-content');
                        if (aboutContent) aboutContent.innerHTML = content.about;
                    }
                });
            }

            // Load settings from Firebase
            if (settingsRef && settingsRef.on) {
                settingsRef.on('value', (snapshot) => {
                    const settings = snapshot.val() || {};
                    if (settings.adFrequency) {
                        adFrequency = settings.adFrequency;
                    }
                });
            }
        }

        function renderCards() {
            if (!elements.linkGrid) {
                console.error('Link grid element not found');
                return;
            }
            
            try {
                elements.linkGrid.innerHTML = '';
                
                if (!filteredLinks || filteredLinks.length === 0) {
                    const emptyMessage = document.createElement('div');
                    emptyMessage.className = 'empty-state';
                    emptyMessage.innerHTML = `
                        <i class="fas fa-inbox"></i>
                        <p>इस श्रेणी के लिए कोई लिंक उपलब्ध नहीं है</p>
                    `;
                    elements.linkGrid.appendChild(emptyMessage);
                    return;
                }
                
                let linkCount = 0;
                let adIndex = 0;
                const adsArray = Object.keys(allAds || {})
                    .map(key => {
                        const ad = allAds[key];
                        return ad ? { ...ad, key } : null;
                    })
                    .filter(ad => ad && ad.active !== false);

                filteredLinks.forEach((link) => {
                    if (!link) return;
                    
                    const linkCard = createLinkCard(link);
                    if (linkCard) {
                        elements.linkGrid.appendChild(linkCard);
                        linkCount++;
                    }

                    // Insert ad after every adFrequency links
                    if (linkCount % adFrequency === 0 && adsArray.length > 0) {
                        const ad = adsArray[adIndex % adsArray.length];
                        if (ad) {
                            const adCard = createAdCard(ad);
                            if (adCard) {
                                elements.linkGrid.appendChild(adCard);
                                adIndex++;
                            }
                        }
                    }
                });
                
                // Add footer ad if there are links
                if (filteredLinks.length > 0 && adsArray.length > 0) {
                    const footerAd = document.createElement('div');
                    footerAd.className = 'adsterra-ad adsterra-ad-between';
                    footerAd.innerHTML = '<p>विज्ञापन स्थान - Adsterra कोड यहाँ</p>';
                    elements.linkGrid.appendChild(footerAd);
                }
                
            } catch (error) {
                console.error('Error rendering cards:', error);
                showToast('कार्ड्स दिखाने में त्रुटि', 'error');
            }
        }

        function createLinkCard(data) {
            if (!data || !data.url) return null;
            
            const card = document.createElement('a');
            card.href = sanitizeURL(data.url);
            card.target = "_blank";
            card.className = 'link-card';
            card.dataset.key = data.key;
            card.rel = "noopener noreferrer";
            
            const cardContent = document.createElement('div');
            cardContent.innerHTML = `
                <div class="card-header">
                    <img src="${data.logoUrl || 'https://via.placeholder.com/40x40?text=Gov'}" 
                         alt="Logo" class="card-logo" 
                         onerror="handleImageError(this, '${getFirstLetter(data.title || 'G')}')">
                    <span class="fallback-text">${getFirstLetter(data.title || 'G')}</span>
                    <div>
                        <h3 class="card-title">${data.title || 'No Title'}</h3>
                    </div>
                </div>
                <p class="card-description">${data.description || 'No description available'}</p>
            `;
            card.appendChild(cardContent);
            
            // Track click analytics
            addSafeEventListener(card, 'click', () => {
                if (currentUser && data.key && analyticsRef) {
                    analyticsRef.child('clicks/' + data.key).push({
                        userId: currentUser.uid,
                        timestamp: Date.now()
                    });
                }
            });
            
            return card;
        }

        function createAdCard(data) {
            if (!data) return null;
            
            const adCard = document.createElement('div');
            adCard.className = 'ad-card';
            adCard.innerHTML = data.code || `
                <p class="ad-card-title">${data.title || 'Advertisement'}</p>
                <img src="${data.imageUrl || 'https://via.placeholder.com/250x80?text=AD'}" 
                     alt="${data.title || 'Advertisement'}" class="ad-card-image" 
                     onerror="handleImageError(this, 'AD')">
                <span class="fallback-text">AD</span>
                <p class="ad-label-small">(विज्ञापन)</p>
            `;
            
            // Track ad views
            if (currentUser && data.key && analyticsRef) {
                analyticsRef.child('views/' + data.key).push({
                    userId: currentUser.uid,
                    timestamp: Date.now()
                });
            }
            
            return adCard;
        }

        // Toast Function with Black Background
        function showToast(message, type = 'info') {
            if (!elements.toast || !elements.toastText || !elements.toastIcon) return;
            
            elements.toastText.textContent = message;
            
            if (type === 'success') {
                elements.toastIcon.className = 'fas fa-check-circle';
            } else if (type === 'error') {
                elements.toastIcon.className = 'fas fa-exclamation-circle';
            } else {
                elements.toastIcon.className = 'fas fa-info-circle';
            }

            // Always black background
            elements.toast.style.backgroundColor = '#000000';
            
            elements.toast.classList.add('show');
            
            setTimeout(() => {
                elements.toast.classList.remove('show');
            }, 3000);
        }

        // Online/Offline Event Listeners
        window.addEventListener('online', () => {
            showToast('कनेक्शन बहाल हो गया', 'success');
            fetchLinksAndAds(); // Reload data when back online
        });

        window.addEventListener('offline', () => {
            showToast('आप ऑफलाइन हैं', 'warning');
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Load language preference from localStorage
            const savedLanguage = localStorage.getItem('saralSahayataLanguage');
            if (savedLanguage && translations[savedLanguage]) {
                currentLanguage = savedLanguage;
            } else {
                // Default to Hindi if no preference saved
                currentLanguage = 'hi';
                localStorage.setItem('saralSahayataLanguage', 'hi');
            }
            
            categories = translations[currentLanguage].categories;
            
            // Update language dropdown
            updateLanguageDropdown();
            
            // Update UI with current language
            updateUIWithLanguage();
            
            // Re-attach auth switch listeners
            reattachAuthSwitchListeners();
            
            // Initialize settings first
            if (settingsRef && settingsRef.on) {
                settingsRef.on('value', (snapshot) => {
                    const settings = snapshot.val();
                    if (settings && settings.adFrequency) {
                        adFrequency = settings.adFrequency;
                    }
                    fetchLinksAndAds();
                }, (error) => {
                    console.error('Error loading settings:', error);
                    fetchLinksAndAds(); // Load data even if settings fail
                });
            } else {
                fetchLinksAndAds(); // Load data directly if settingsRef not available
            }

            renderCategories();
            checkOnlineStatus();
            showHomePage(); // Start with home page
            showToast(translations[currentLanguage].welcome, 'success');
        });
    </script>
</body>
</html>
